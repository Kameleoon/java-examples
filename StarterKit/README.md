# Kameleoon Java Starter Kit

> The Kameleoon Java Starter Kit demonstrates Kameleoon experimentation and feature flags.

This repository is home to the Kameleoon starter kit for Java. Kameleoon is a powerful experimentation and personalization platform for product teams that enables you to make insightful discoveries by testing the features on your roadmap. Discover more at https://kameleoon.com, or see the [developer documentation](https://developers.kameleoon.com).

## Using the Starter Kit

This starter kit provides quickstart instructions for developers using the [Kameleoon Java SDK](https://developers.kameleoon.com/feature-management-and-experimentation/web-sdks/java-sdk/).

### Prerequisites

Make sure you have the following requirements before you get started:

1. A Kameleoon user account. Visit [kameleoon.com](https://www.kameleoon.com/) to learn more.
2. Have the `Java 1.8` (or later) installed.
3. Have the [`Maven`](https://maven.apache.org/download.cgi) installed.

### Get started

To get started, follow these steps:

1. Clone the repository and move into the `StarterKit/` directory:

```bash
git clone git@github.com:Kameleoon/java-examples.git
cd java-examples/StarterKit
```

2. In the `application.yml` file, set your `clientId`, `clientSecret`, and `siteCode`. To start the server locally, leave `localhost` as `topLevelDomain`. If you want to deploy on remote server, set the `topLevelDomain` to your actual top-level domain:

```yml
kameleoon:
  clientId: clientId
  clientSecret: clientSecret
  siteCode: siteCode
  topLevelDomain: localhost
```

3. By default, the server runs locally on port `4300`. In the `application.yml` you can changed port:

```yml
server:
  port: 4300
```

4. Run the server.

```bash
mvn spring-boot:run
```

### Usage

> [Swagger](http://localhost:4300/swagger-ui/index.html?url=/v3/api-docs) is available.

1. After the server starts, you can fetch the variation of a visitor code that's generated by the SDK by visiting a URL:
```
http://localhost:4300/Variation?featureKey=<featureKey>
```

2. If you need to reset the visitor code, delete the `kameleoonVisitorCode` cookie for `localhost` in your browser.

## How it works

### Initialization

Copy the initialization code snippet found in the `ClientConfig.java` file into your own code. Make sure you properly handle the possible exceptions.

```java
try {
    KameleoonClientConfig configuration = new KameleoonClientConfig.Builder()
            .clientId(kameleoonProperties.getClientId())
            .clientSecret(kameleoonProperties.getClientSecret())
            .topLevelDomain(kameleoonProperties.getTopLevelDomain())
            .build();
    return KameleoonClientFactory.create(kameleoonProperties.getSiteCode(), configuration);
} catch (KameleoonException ex) {
    logger.error(ex.getMessage());
}
```

### Getting the visitor code

To get the visitor code, provide the `HttpServletRequest` and `HttpServletResponse` values to the `GetVisitorCode` method. The SDK will check the cookies for an existing visitor code. If a visitor code is not found, the SDK generates a new visitor code.

```java
String visitorCode = kameleoonClient.getVisitorCode(request, response);
```

### Get variation

To get the variation assigned to the visitor, call `GetFeatureVariationKey` with the `visitorCode` and `featureKey`. Make sure you handle the possible exceptions.

```java
String visitorCode = kameleoonClient.getVisitorCode(request, response);
try {
    String variationKey = kameleoonClient.getFeatureVariationKey(visitorCode, featureKey);
    return new Response(visitorCode, variationKey);
} catch (KameleoonException.VisitorCodeInvalid | KameleoonException.FeatureNotFound |
        KameleoonException.FeatureEnvironmentDisabled exception) {
    logger.error("Expected KameleoonException", exception);
} catch (Exception exception) {
    logger.error("Unexpected Exception", exception);
}
```
